<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member.mapper.MemberMapper">
	<!-- signup -->
	<select id="nameOverlapCheck" parameterType="String" resultType="Integer">
		select count(*)
		from member
		where name = #{name}
	</select>
	<!-- login -->
	<select id="login" parameterType="Map" resultType="mdto">
		select * from member where email = #{email} and password = #{password}
	</select>
	
	<insert id="signup" parameterType="mdto">
		insert into member(email,password,birth,name,joinday,emailcheck,admin,profile,provider,point)
		values(#{email},#{password},#{birth},#{name},now(),'n',0,'','default',0)
	</insert>
	
	<update id="updateEmailCheck" parameterType="String">
		update member 
		set emailcheck = 'y'
		where email = #{email} 
	</update>
	
	<select id="emailCount" parameterType="Map" resultType="int">
		select count(*) 
		from member 
		where email = #{email} and 
			  password = #{password}
	</select>
	
	<select id="emailAuth" parameterType="String" resultType="String">
		select emailcheck 
		from member
		where email = #{email}
	</select>
	
	<select id="socialCount" parameterType="Map" resultType="Integer">
		select count(*) from member where email = #{email} and provider = #{provider}
	</select>
	
	<insert id="socialSignUp" parameterType="Map">
		insert into 
		member(email,name,joinday,emailcheck,admin,profile,provider,point) 
		values(#{email},#{name},now(),'y',0,#{profile},#{provider},0);
	</insert>
	
	<select id="socialLogin" parameterType="Map" resultType="mdto">
		select * 
		from member
		where email = #{email} and provider = #{provider}
	</select>
		
	<select id="emailOverlapCheck" parameterType="String" resultType="int">
		select count(*)
		from member
		where email = #{email}
	</select>
	
	<select id="emailFound" parameterType="String" resultType="int">
		select count(*)
		from member where 
		email = #{email}
	</select>
	
	<update id="passwordUpdate" parameterType="Map">
		update member
		set password = #{password}
		where email = #{email}
	</update>
	
	<!-- attendance -->
	<select id="attendanceCheck" parameterType="String" resultType="Integer">
		select count(*)
		from attendance
		where email = #{email} and attday = curdate() 
	</select>
	
	<insert id="attendanceInsert" parameterType="String">
		insert into attendance
		values(#{email}, now())
	</insert>
	
	<update id="updateMemberPoint" parameterType="String">
		update member 
		set point = point + 100 
		where email = #{email}
	</update>
	
	<update id="profileImgUpdate" parameterType="Map">
		update member
		set profile = #{fileName}
		where email = #{email}
	</update>
	
	<select id="memberNo" parameterType="String" resultType="Integer">
		select no 
		from member
		where email = #{email}
	</select>
	
	<update id="updateProfileImg" parameterType="Map">
		update member
		set profile = #{profile}
		where email = #{email}
	</update>
</mapper>